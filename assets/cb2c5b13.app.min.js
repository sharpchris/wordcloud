/*! wordcloud-app  2022-08-12 */

var FACEBOOK_APP_ID="",IMGUR_CLIENT_ID="",DONATE_HTML="",WordCloudApp=function(){if(!((window.WordFreq&&window.WordFreq.isSupported||window.WordFreqSync&&window.WordFreqSync.isSupported)&&WordCloud.isSupported&&Object.keys&&Array.prototype.map&&Array.prototype.forEach&&Array.prototype.indexOf&&Function.prototype.bind&&"onhashchange"in window))return window.onload=function(){var e=document.getElementById("wc-browser-support");try{delete e.hidden}catch(e){}e.removeAttribute&&e.removeAttribute("hidden")},this.isSupported=!1,void this.logAction("WordCloudApp::isSupported::false");this.isSupported=!0,this.logAction("WordCloudApp::isSupported::true"),this.isFullySupported=function(){if(!FilePanelView.prototype.isSupported)return!1;if(window.HTMLCanvasElement.prototype.toBlob)return!0;var e=window.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;return!!((e||t)&&window.atob&&window.ArrayBuffer&&window.Uint8Array)}(),this.logAction("WordCloudApp::isFullySupported::"+this.isFullySupported),window.addEventListener("load",this),this.fetchers={},this.views={},this.currentUIState=this.UI_STATE_LOADING,this.UIStateViewMap=[["loading"],["canvas","source-dialog"],["loading","dashboard"],["canvas","dashboard"],["canvas","dashboard","list-dialog"],["loading","dashboard"],["canvas","dashboard","sharer-dialog"],["canvas","about-dialog"]],this.wordfreqOption={workerUrl:"./assets/wordfreq/src/wordfreq.worker.js?_=l6qsj7ny"},this.shapes=[{shape:"circle"},{shape:function(e){var t=(e+Math.PI/4)%(2*Math.PI/4);return 1/(Math.cos(t)+Math.sin(t))}},{shape:"triangle-forward",ellipticity:1},{shape:"star",ellipticity:1}];function e(e){return function(){return e[Math.floor(Math.random()*e.length)]}}var t='"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',i='Baskerville, "Times New Roman", "華康儷金黑 Std", "華康儷宋 Std",  DFLiKingHeiStd-W8, DFLiSongStd-W5, "Hiragino Mincho Pro", "LiSong Pro Light", "新細明體", serif';this.themes=[{fontFamily:i,color:e(["#66d9ef","#a6e22d","#fd9720","#a6e22a","#a581ff","#f92772"]),backgroundColor:"#272822"},{fontFamily:t,color:e(["#07ABDA","#63D6F6","#0F7BDC","#69B4F7","#00DBB6","#376F65","#004438","#5FF7DD"]),backgroundColor:"#AAF7EA"},{fontFamily:i,color:e(["#2F55D1","#4058A5","#133193","#98AFFD"]),backgroundColor:"#e3e9fd"},{fontFamily:t,color:e(["#c30000","#c37a00","#650281","#de3333","#de5c5c","#7e602c","#633e00","#481e53"]),backgroundColor:"#edd1a4"},{fontFamily:t,color:function(){return"rgb("+Math.floor(128*Math.random()+48).toString(10)+","+Math.floor(128*Math.random()+48).toString(10)+","+Math.floor(128*Math.random()+48).toString(10)+")"},backgroundColor:"#eee"},{fontFamily:i,color:"random-light",backgroundColor:"#000"},{fontFamily:i,color:e(["#3a3f42","#575d51","#42361d"]),backgroundColor:"#8d8380"},{fontFamily:i,color:e(["#f7e4be","#f0f4bc","#9a80a4","#848da6"]),backgroundColor:"#223564"},{fontFamily:i,color:"#d0d0d0",backgroundColor:"#999"},{fontFamily:t,color:"rgba(255,255,255,0.8)",backgroundColor:"#353130"},{fontFamily:t,color:"rgba(0,0,0,0.7)",backgroundColor:"rgba(255, 255, 255, 1)"}],this.data={theme:0,shape:0,gridSize:void 0,weightFactor:void 0,drawOutOfBound:!0}};WordCloudApp.prototype.addView=function(e){(this.views[e.name]=e).app=this},WordCloudApp.prototype.addFetcher=function(t){t.types.forEach(function(e){this.fetchers[e]=t}.bind(this)),t.app=this},WordCloudApp.prototype.pushUrlHash=function(e){if(e===window.location.hash)return this.route(),!0;this.backToReset=!window.location.hash.substr(1),this.lastUrlHashChangePushedByScript=!0;try{window.location.hash=e}catch(e){return!1}return!0},WordCloudApp.prototype.reset=function(){window.location.hash.substr(1)&&(this.backToReset?window.history.back():this.pushUrlHash(""))},WordCloudApp.prototype.UI_STATE_LOADING=0,WordCloudApp.prototype.UI_STATE_SOURCE_DIALOG=1,WordCloudApp.prototype.UI_STATE_WORKING=2,WordCloudApp.prototype.UI_STATE_DASHBOARD=3,WordCloudApp.prototype.UI_STATE_LIST_DIALOG=4,WordCloudApp.prototype.UI_STATE_ERROR_WITH_DASHBOARD=5,WordCloudApp.prototype.UI_STATE_SHARER_DIALOG=6,WordCloudApp.prototype.UI_STATE_ABOUT_DIALOG=7,WordCloudApp.prototype.switchUIState=function(t){if(!this.UIStateViewMap[t])throw"Undefined state "+t;document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur();var e=Object.keys(this.views),i=this.currentUIState;e.forEach(function(e){this.views[e][-1!==this.UIStateViewMap[t].indexOf(e)?"show":"hide"](i,t)}.bind(this)),this.currentUIState=t},WordCloudApp.prototype.handleData=function(o,e){if(this.logAction("WordCloudApp::handleData",e+" ("+o.length+")"),!o.length)return this.switchUIState(this.UI_STATE_ERROR_WITH_DASHBOARD),void this.views.loading.updateLabel(this.views.loading.LABEL_ERROR_DATA);var t;this.currentFetcher=void 0,this.views.loading.updateLabel(this.views.loading.LABEL_ANALYZING),this.data.title=e,WordFreq?this.wordfreq=WordFreq(this.wordfreqOption).process(o).getVolume(function(e){t=e}).getList(function(e){this.wordfreq=void 0,this.handleList(e,t)}.bind(this)):this.wordfreq=setTimeout(function(){var e=WordFreqSync(this.wordfreqOption),t=e.process(o),i=e.getVolume();this.wordfreq=void 0,this.handleList(t,i)}.bind(this))},WordCloudApp.prototype.stopHandleData=function(){this.wordfreq&&("object"==typeof this.wordfreq?this.wordfreq.stop(!1):clearTimeout(this.wordfreq),this.wordfreq=void 0)},WordCloudApp.prototype.handleList=function(e,t){if(this.logAction("WordCloudApp::handleList",e.length),!e.length)return this.switchUIState(this.UI_STATE_ERROR_WITH_DASHBOARD),void this.views.loading.updateLabel(this.views.loading.LABEL_ERROR_LIST);this.switchUIState(this.UI_STATE_DASHBOARD),this.data.list=e,this.data.gridSize=4,this.data.theme=Math.floor(Math.random()*this.themes.length),this.calculateWeightFactor(t),this.draw()},WordCloudApp.prototype.draw=function(){var e=this.views.canvas;e.setDimension(),e.draw(this.getWordCloudOption());var t=this.parseHash();this.logAction("WordCloudApp::draw::"+t[0],t[1].substr(0,128))},WordCloudApp.prototype.getCanvasElement=function(){return this.views.canvas.canvasElement},WordCloudApp.prototype.calculateWeightFactor=function(e){var t=this.views.canvas.documentWidth,i=this.views.canvas.documentHeight;this.data.weightFactor=Math.sqrt(t*i/e)},WordCloudApp.prototype.getWordCloudOption=function(){var t={};return Object.keys(this.data).forEach(function(e){t[e]=this.data[e]}.bind(this)),Object.keys(this.themes[this.data.theme]).forEach(function(e){t[e]=this.themes[this.data.theme][e]}.bind(this)),Object.keys(this.shapes[this.data.shape]).forEach(function(e){t[e]=this.shapes[this.data.shape][e]}.bind(this)),t},WordCloudApp.prototype.showSharer=function(){this.switchUIState(this.UI_STATE_SHARER_DIALOG)},WordCloudApp.prototype.route=function(){var e=window.location.hash.substr(1);if(this.backToReset&&!this.lastUrlHashChangePushedByScript&&(this.backToReset=!1),this.lastUrlHashChangePushedByScript=!1,this.currentFetcher&&(this.currentFetcher.stop(),this.currentFetcher=void 0),this.stopHandleData(),!e)return this.switchUIState(this.UI_STATE_SOURCE_DIALOG),void this.logAction("WordCloudApp::route::source-dialog");var t=this.parseHash(),i=t[0],o=t[1];t=void 0,this.logAction("WordCloudApp::route::"+i,o.substr(0,128));var a=-1===i.indexOf(".")?i:i.split(".")[0];if(a in this.fetchers){this.switchUIState(this.UI_STATE_WORKING);var n=this.currentFetcher=this.fetchers[a];this.views.loading.updateLabel(n.LABEL_VERB),n.getData(i,o)}else this.reset()},WordCloudApp.prototype.logAction=function(e,t,i){if(window._paq){var o=["trackEvent","Word Cloud"];void 0!==e&&(o.push(e.toString()),void 0!==t&&(o.push(t.toString()),void 0!==i&&o.push(parseFloat(i,10)))),window._paq.push(o)}},WordCloudApp.prototype.parseHash=function(){var i,o;return window.location.hash.substr(1).match(/^([^:]+):?(.*)$/).forEach(function(e,t){switch(t){case 1:i=e;break;case 2:o=e}}),[i,o]},WordCloudApp.prototype.handleEvent=function(e){switch(e.type){case"load":window.removeEventListener("load",this),window.addEventListener("hashchange",this),this.route();break;case"hashchange":this.route()}},WordCloudApp.prototype.uninit=function(){window.removeEventListener("load",this),window.removeEventListener("hashchange",this)};var FacebookSDKLoader=function(){if(!FACEBOOK_APP_ID)throw"No FACEBOOK_APP_ID defined.";this.loaded=!1};FacebookSDKLoader.prototype.load=function(e){if(this.loaded)throw"FacebookSDKLoader shouldn't be reused.";if(this.loaded=!0,window.FB)e();else if(window.fbAsyncInit){var t=window.fbAsyncInit;window.fbAsyncInit=function(){window.fbAsyncInit=null,t(),e()}.bind(this)}else{var i,o,a,n,r,s=document.createElement("div");s.id="fb-root",document.body.insertBefore(s,document.body.firstChild),i=document,o="script",a="facebook-jssdk",r=i.getElementsByTagName(o)[0],i.getElementById(a)||((n=i.createElement(o)).id=a,n.src="//connect.facebook.net/en_US/all.js",r.parentNode.insertBefore(n,r));var l=window.FACEBOOK_CHANNEL_URL||document.location.href.replace(/\/(index.html)?(#.*)?$/i,"/facebook-channel.html");window.fbAsyncInit=function(){window.fbAsyncInit=null,FB.init({appId:FACEBOOK_APP_ID,channelUrl:l}),e()}}};var View=function(){};View.prototype.load=function(e,t){for(var i in e=e||{},t){if(i in this)break;this[i]=i in e?e[i]:t[i],"element"!==i&&!/Element$/.test(i)||(this[i]="string"==typeof this[i]?document.getElementById(this[i]):this[i])}},View.prototype.show=function(e,t){return!("beforeShow"in this&&!1===this.beforeShow.apply(this,arguments))&&(this.element.removeAttribute("hidden"),"afterShow"in this&&this.afterShow.apply(this,arguments),!0)},View.prototype.hide=function(e,t){return!("beforeHide"in this&&!1===this.beforeHide.apply(this,arguments))&&(this.element.setAttribute("hidden",!0),"afterHide"in this&&this.afterHide.apply(this,arguments),!0)};var LanguageSwitcherView=function(e){this.load(e,{element:"wc-language"});var t=navigator.language||navigator.userLanguage;t=t.replace(/-[a-z]{2}$/i,function(e){return e.toUpperCase()});var i=this.langs=[];Array.prototype.forEach.call(this.element.children,function(e){i.push(e.value),e.value===t&&(e.selected=!0)}),-1===i.indexOf(t)&&(this.element.selectedIndex=0),document.addEventListener("localized",this),this.element.addEventListener("change",this)};LanguageSwitcherView.prototype=new View,LanguageSwitcherView.prototype.handleEvent=function(e){switch(e.type){case"change":document.webL10n.setLanguage(this.element.value),this.app.logAction("LanguageSwitcherView::change",this.element.value);break;case"localized":this.app.logAction("LanguageSwitcherView::localized",document.documentElement.lang)}};var LoadingView=function(e){this.load(e,{name:"loading",element:"wc-loading",labelElement:"wc-loading-label"}),this.stringIds=["downloading","loading","analyzing","no_data","no_list_output"]};LoadingView.prototype=new View,LoadingView.prototype.LABEL_DOWNLOADING=0,LoadingView.prototype.LABEL_LOADING=1,LoadingView.prototype.LABEL_ANALYZING=2,LoadingView.prototype.LABEL_ERROR_DATA=3,LoadingView.prototype.LABEL_ERROR_LIST=4,LoadingView.prototype.beforeShow=function(e,t){t===this.app.UI_STATE_ERROR_WITH_DASHBOARD?this.element.className="error":this.element.className=""},LoadingView.prototype.updateLabel=function(e){if(!this.stringIds[e])throw"Undefined stringId "+e;this.labelElement.setAttribute("data-l10n-id",this.stringIds[e]),__(this.labelElement)};var ListDialogView=function(e){this.load(e,{name:"list-dialog",element:"wc-list-dialog",textElement:"wc-list-edit",cancelBtnElement:"wc-list-cancel-btn",confirmBtnElement:"wc-list-confirm-btn"}),this.cancelBtnElement.addEventListener("click",this),this.confirmBtnElement.addEventListener("click",this)};ListDialogView.prototype=new View,ListDialogView.prototype.beforeShow=function(){this.textElement.value=this.app.data.list.map(function(e){return e[1]+"\t"+e[0]}).join("\n")},ListDialogView.prototype.afterShow=function(){this.textElement.focus()},ListDialogView.prototype.handleEvent=function(e){switch(e.target){case this.confirmBtnElement:this.submit();break;case this.cancelBtnElement:this.close()}},ListDialogView.prototype.submit=function(){var e,t=this.textElement;e=window.btoa?"#base64-list:"+window.btoa(unescape(encodeURIComponent(t.value))):"#list:"+encodeURIComponent(t.value),this.app.pushUrlHash(e)||this.app.pushUrlHash("#list")},ListDialogView.prototype.close=function(){this.app.switchUIState(this.app.UI_STATE_DASHBOARD)};var AboutDialogView=function(e){this.load(e,{name:"about-dialog",element:"wc-about-dialog",donateElement:"wc-about-donate",donateContentElement:"wc-about-donate-content",contentElement:"wc-about-content",closeBtnElement:"wc-about-close-btn"}),this.loaded=!1,this.closeBtnElement.addEventListener("click",this),this.contentElement.addEventListener("click",this),this.donateContentElement.addEventListener("submit",this),document.addEventListener("localized",this)};AboutDialogView.prototype=new View,AboutDialogView.prototype.beforeShow=function(){this.app.logAction("AboutDialogView::view"),this.loaded=!0;var e=document.documentElement.lang;this.loadContent(e,!0)},AboutDialogView.prototype.loadContent=function(e,t){var o=document.createElement("iframe");o.src="about."+e+".html",this.contentElement.appendChild(o),o.onload=function(){for(var e=document.importNode(o.contentWindow.document.body,!0),t=document.createDocumentFragment();e.firstElementChild;)t.appendChild(e.firstElementChild);for(var i=this.contentElement;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(t)}.bind(this),t&&(o.onerror=function(){this.loaded=!1,this.element.hasAttribute("hidden")||this.app.switchUIState(this.app.UI_STATE_SOURCE_DIALOG)}.bind(this)),window.DONATE_HTML&&(this.donateElement.removeAttribute("hidden"),this.donateContentElement.innerHTML=window.DONATE_HTML.replace(/%lang/,e.replace(/-/,"_")))},AboutDialogView.prototype.handleEvent=function(e){if("localized"!==e.type)switch(e.currentTarget){case this.contentElement:if("A"!==e.target.tagName)break;e.preventDefault(),window.open(e.target.href),this.app.logAction("AboutDialogView::externalLink",e.target.href);break;case this.donateContentElement:this.app.logAction("AboutDialogView::donateLink");break;case this.closeBtnElement:this.close()}else this.loaded=!1},AboutDialogView.prototype.close=function(){this.app.switchUIState(this.app.UI_STATE_SOURCE_DIALOG)};var SNSPushView=function(e){this.load(e,{name:"sns-push",element:"wc-sns-push",facebookElement:"wc-sns-facebook"}),"1"!==navigator.doNotTrack&&("complete"===document.webL10n.getReadyState()&&this.loadButtons(),window.addEventListener("localized",this))};SNSPushView.prototype=new View,SNSPushView.prototype.FACEBOOK_BUTTON_URL="https://www.facebook.com/plugins/like.php?href=%url&layout=box_count&show_faces=false&width=55&action=like&font=trebuchet+ms&colorscheme=light&height=65&locale=%lang",SNSPushView.prototype.beforeShow=function(){return"1"!==navigator.doNotTrack},SNSPushView.prototype.loadButtons=function(){var e=window.location.href;-1!==e.indexOf("#")&&(e=e.replace(/#.*$/,"").replace(/\?.*$/,""));var t=document.documentElement.lang;this.updateFrame(this.facebookElement,this.FACEBOOK_BUTTON_URL.replace(/%url/,encodeURIComponent(e)).replace(/%lang/,t.replace(/-/,"_")))},SNSPushView.prototype.updateFrame=function(e,t){for(;e.firstElementChild;)e.removeChild(e.firstElementChild);var i=document.createElement("iframe");i.src=t,i.setAttribute("scrolling","no"),i.setAttribute("frameborder","0"),i.setAttribute("allowTransparency","true"),e.appendChild(i)},SNSPushView.prototype.handleEvent=function(e){switch(e.type){case"localized":this.loadButtons()}};var PSMView=function(e){this.load(e,{name:"psm",element:"wc-psm"}),"complete"===document.webL10n.getReadyState()&&this.loadFrame(),window.addEventListener("localized",this)};PSMView.prototype=new View,PSMView.prototype.URL="//timdream.org/psm/#locale=%lang",PSMView.prototype.loadFrame=function(){for(var e=document.documentElement.lang,t=this.element;t.firstElementChild;)t.removeChild(t.firstElementChild);var i=document.createElement("iframe");i.src=this.URL.replace(/%lang/,e),i.setAttribute("scrolling","no"),i.setAttribute("frameborder","0"),i.setAttribute("allowTransparency","true"),t.appendChild(i)},PSMView.prototype.handleEvent=function(e){switch(e.type){case"localized":this.loadFrame()}};var CanvasView=function(e){this.load(e,{name:"canvas",element:"wc-canvas",canvasElement:"wc-canvas-canvas",hoverElement:"wc-canvas-hover",hoverLabelElement:"wc-canvas-hover-label"}),window.addEventListener("resize",this),this.canvasElement.addEventListener("wordcloudstop",this),this.documentWidth=window.innerWidth,this.documentHeight=window.innerHeight;var i,o,t=this.canvasElement.style;["transform","webkitTransform","msTransform","oTransform"].some(function(e){return e in t&&(this.cssTransformProperty=e,!0)}.bind(this)),this.idleOption={fontFamily:"Times, serif",color:"rgba(255, 255, 255, 0.8)",rotateRatio:.5,backgroundColor:"transparent",wait:75,list:(i=[],o="Arai,Awan,Bodjal,Boira,Bulud,Bulut,Caad,Chmura,Clood,Cloud,Cwmwl,Dampog,Debesis,Ewr,Felhő,Hodei,Hûn,Koumoul,Leru,Lipata,Mixtli,Moln,Mây,Méga,Mākoņi,Neul,Niula,Nivulu,Nor,Nouage,Nuage,Nube,Nubes,Nubia,Nubo,Nuvem,Nuvi,Nuvia,Nuvola,Nwaj,Nívol,Nóvvla,Nùvoła,Nùvula,Núvol,Nûl,Nûlêye,Oblaci,Oblak,Phuyu,Pil'v,Pilv,Pilvi,Qinaya,Rahona,Rakun,Retë,Scamall,Sky,Ský,Swarken,Ulap,Vo'e,Wingu,Wolcen,Wolk,Wolke,Wollek,Wulke,dilnu,Νέφος,Абр,Болот,Болытлар,Булут,Бұлттар,Воблакі,Облак,Облака,Хмара,Үүл,Ամպ,וואלקן,ענן,ابر,بادل,بدل,سحاب,ورېځ,ھەور,ܥܢܢܐ,ढग,बादल,सुपाँय्,মেঘ,ਬੱਦਲ,વાદળ,முகில்,మేఘం,മേഘം,เมฆ,སྤྲིན།,ღრუბელი,ᎤᎶᎩᎸ,ᓄᕗᔭᖅ,云,雲,구름".split(","),[5,4,3,2,2].forEach(function(t){o.forEach(function(e){i.push([e,t])})}),i)}};CanvasView.prototype=new View,CanvasView.prototype.TILT_DEPTH=10,CanvasView.prototype.beforeShow=CanvasView.prototype.beforeHide=function(e,t){switch(t){case this.app.UI_STATE_SOURCE_DIALOG:if(e==this.app.UI_STATE_ABOUT_DIALOG)break;this.drawIdleCloud();break;case this.app.UI_STATE_LOADING:case this.app.UI_STATE_WORKING:this.empty()}},CanvasView.prototype.handleEvent=function(e){switch(e.type){case"resize":this.documentWidth=window.innerWidth,this.documentHeight=window.innerHeight;break;case"wordclouddrawn":if(e.detail.drawn)break;e.preventDefault();break;case"wordcloudstop":this.canvasElement.removeEventListener("wordclouddrawn",this);break;case"mousemove":var t=this.documentWidth/2,i=this.documentHeight/2,o=-(t-e.pageX)/t*this.TILT_DEPTH,a=(i-e.pageY)/i*this.TILT_DEPTH;this.canvasElement.style[this.cssTransformProperty]="scale(1.2) translateZ(0) rotateX("+a+"deg) rotateY("+o+"deg)"}},CanvasView.prototype.setDimension=function(e,t){var i=this.canvasElement;e=e||this.documentWidth,t=t||this.documentHeight,i.setAttribute("width",e),i.setAttribute("height",t),this.element.style.marginLeft=-e/2+"px",this.element.style.marginTop=-t/2+"px"},CanvasView.prototype.draw=function(e){this.canvasElement.lang="",this.hoverElement.setAttribute("hidden",!0),e.hover=this.handleHover.bind(this),WordCloud(this.canvasElement,e)},CanvasView.prototype.handleHover=function(e,t){var i=this.hoverElement;e?(i.removeAttribute("hidden"),i.style.left=t.x+"px",i.style.top=t.y+"px",i.style.width=t.w+"px",i.style.height=t.h+"px",this.hoverDimension=t,this.hoverLabelElement.setAttribute("data-l10n-args",JSON.stringify({word:e[0],count:e[1]})),__(this.hoverLabelElement)):i.setAttribute("hidden",!0)},CanvasView.prototype.drawIdleCloud=function(){var e=this.canvasElement,t=this.documentWidth,i=this.documentHeight;"ontouchstart"in window||document.addEventListener("mousemove",this),this.canvasElement.style[this.cssTransformProperty]="scale(1.2)",this.setDimension(t,i),this.idleOption.gridSize=Math.round(16*t/1024),this.idleOption.weightFactor=function(e){return Math.pow(e,2.3)*t/1024},e.lang="en",e.addEventListener("wordclouddrawn",this),WordCloud(e,this.idleOption),this.hoverElement.setAttribute("hidden",!0)},CanvasView.prototype.empty=function(){document.removeEventListener("mousemove",this),this.canvasElement.style[this.cssTransformProperty]="",WordCloud(this.canvasElement,{backgroundColor:"transparent"})};var SourceDialogView=function(e){this.load(e,{name:"source-dialog",element:"wc-source-dialog",menuElement:"wc-source-menu",selectionElement:"wc-source-selection",startBtnElement:"wc-source-start-btn",panelContainerElement:"wc-source-panels",aboutBtnElement:"wc-source-about-btn"}),this.currentPanel=null,this.panels={};var i=this.selectionElement,t=this.menuElement.getElementsByTagName("a");Array.prototype.forEach.call(t,function(e){var t=document.createElement("option");t.value=e.getAttribute("data-panel"),t.setAttribute("data-l10n-id",e.getAttribute("data-l10n-id")),t.appendChild(document.createTextNode(e.textContent)),i.appendChild(t)}),this.menuElement.addEventListener("click",this),this.selectionElement.addEventListener("change",this),this.startBtnElement.addEventListener("click",this),this.panelContainerElement.addEventListener("submit",this),this.aboutBtnElement.addEventListener("click",this)};SourceDialogView.prototype=new View,SourceDialogView.prototype.afterShow=function(){this.currentPanel&&this.currentPanel.show()},SourceDialogView.prototype.handleEvent=function(e){var t;if(e.preventDefault(),"submit"!=e.type)switch(e.currentTarget){case this.menuElement:if(!(t=e.target.getAttribute("data-panel"))||!this.panels[t])return;this.showPanel(this.panels[t]);break;case this.selectionElement:if(!(t=e.target.value)||!this.panels[t])return;this.showPanel(this.panels[t]);break;case this.aboutBtnElement:this.app.switchUIState(this.app.UI_STATE_ABOUT_DIALOG);break;case this.startBtnElement:this.currentPanel.submit()}else this.currentPanel.submit()},SourceDialogView.prototype.submit=function(e){return this.app.pushUrlHash(e)},SourceDialogView.prototype.showPanel=function(e){this.currentPanel&&this.currentPanel.hide(),e.show(),this.currentPanel=e,this.app&&this.app.logAction("SourceDialogView::showPanel",e.name)},SourceDialogView.prototype.addPanel=function(e){if((this.panels[e.name]=e).menuItemElement=this.menuElement.querySelector('[data-panel="'+e.name+'"]'),e.selectionIndex=Array.prototype.indexOf.call(this.menuElement.children,e.menuItemElement.parentNode),!e.menuItemElement)throw"menuItemElement not found.";if(e.menuItemElement.parentNode.removeAttribute("hidden"),e.dialog=this,"isSupported"in e&&!e.isSupported)return e.menuItemElement.parentNode.className+=" disabled",void e.menuItemElement.removeAttribute("data-panel");this.currentPanel||this.showPanel(e)};var DashboardView=function(e){this.load(e,{name:"dashboard",element:"wc-dashboard"});for(var t=this.element.querySelectorAll("[data-action]"),i=t.length;i--;)t[i].addEventListener("click",this)};DashboardView.prototype=new View,DashboardView.prototype.beforeShow=DashboardView.prototype.beforeHide=function(e,t){var i,o=this.element.querySelectorAll("[data-canvas-ctl]"),a=o.length;if(t===this.app.UI_STATE_DASHBOARD)for(;a--;)(i=o[a]).className=i.className.replace(/ disabled/g,"");else for(;a--;)(i=o[a]).className+=" disabled"},DashboardView.prototype.handleEvent=function(e){var t=e.currentTarget;if(-1===t.className.indexOf("disabled")){var i=this.app,o=t.getAttribute("data-action");switch(this.app.logAction("DashboardView::action",o),o){case"back":i.reset();break;case"refresh":i.draw();break;case"theme":i.data.theme++,i.data.theme>=i.themes.length&&(i.data.theme=0),i.draw();break;case"shape":i.data.shape++,i.data.shape>=i.shapes.length&&(i.data.shape=0),i.draw();break;case"edit":i.switchUIState(i.UI_STATE_LIST_DIALOG);break;case"size+":i.data.weightFactor+=.1,i.draw();break;case"size-":if(i.data.weightFactor<=.1)break;i.data.weightFactor-=.1,i.draw();break;case"gap+":i.data.gridSize++,i.draw();break;case"gap-":if(i.data.gridSize<=2)break;i.data.gridSize--,i.draw();break;case"save":var a=i.getCanvasElement().toDataURL();if("download"in document.createElement("a"))t.href=a,setTimeout(function(){t.href="#"},0);else{e.preventDefault();function n(){r.removeEventListener("load",n),r.detachEvent&&r.detachEvent("onload",n);for(var e=r.document;e.body.firstElementChild;)e.body.removeChild(e.body.firstElementChild);var t=e.createElement("img");t.id="popup-image",t.src=a,e.getElementsByTagName("title")[0].textContent=_("image-popup-title"),e.body.appendChild(t)}var r=window.open("blank.html","_blank","width=500,height=300,resizable=yes,menubar=yes");r.attachEvent?"complete"===r.document.readyState?n():r.attachEvent("onload",n):r.addEventListener("load",n)}break;case"share":i.showSharer()}}};var SharerDialogView=function(e){if(this.load(e,{name:"sharer-dialog",element:"wc-sharer-dialog",titleElement:"wc-sharer-title",imgElement:"wc-sharer-img",imgLinkElement:"wc-sharer-img-link",progressElement:"wc-sharer-progress",titleInputElement:"wc-sharer-title-input",descInputElement:"wc-sharer-desc",termsElement:"wc-sharer-terms",hashTagElement:"wc-sharer-hashtag",imgurStatusElement:"wc-sharer-imgur-status",facebookStatusElement:"wc-sharer-facebook-status",tumblrStatusElement:"wc-sharer-tumblr-status",twitterStatusElement:"wc-sharer-twitter-status",plurkStatusElement:"wc-sharer-plurk-status",reUploadBtnElement:"wc-sharer-reupload-btn",doneBtnElement:"wc-sharer-done-btn"}),this.hashTagElement.textContent=this.HASHTAG,this.imgLinkElement.addEventListener("click",this),this.imgurStatusElement.addEventListener("click",this),this.facebookStatusElement.addEventListener("click",this),this.tumblrStatusElement.addEventListener("click",this),this.twitterStatusElement.addEventListener("click",this),this.plurkStatusElement.addEventListener("click",this),this.doneBtnElement.addEventListener("click",this),this.reUploadBtnElement.addEventListener("click",this),window.URL&&this.imgElement.addEventListener("load",function(){window.URL.revokeObjectURL(this.src)}),!window.HTMLCanvasElement.prototype.toBlob){var t=document.createElement("script");t.src="./assets/canvas-to-blob/canvas-to-blob.min.js?_=l6qsj7ny",document.documentElement.firstElementChild.appendChild(t)}this.stringIds=["image-upload-not-supported","share-text-only","image-uploading","waiting","image-uploaded","click-to-share","image-upload-failed","facebook-loading","load-facebook-sdk","facebook-sdk-loading"]};SharerDialogView.prototype=new View,SharerDialogView.prototype.HASHTAG="#HTML5WordCloud",SharerDialogView.prototype.TWITTER_SHARE_URL="https://twitter.com/home/?status=",SharerDialogView.prototype.PLURK_SHARE_URL="https://plurk.com/?status=",SharerDialogView.prototype.FACEBOOK_PHOTO_URL="https://www.facebook.com/photo.php?fbid=",SharerDialogView.prototype.FACEBOOK_POST_URL="https://www.facebook.com/permalink.php?id=%uid&v=wall&story_fbid=%fbid",SharerDialogView.prototype.IMGUR_URL="https://imgur.com/",SharerDialogView.prototype.IMGUR_API_URL="https://api.imgur.com/3/upload.json",SharerDialogView.prototype.SHARED_ITEM_LIMIT=10,SharerDialogView.prototype.LABEL_IMAGE_UPLOAD_NOT_SUPPORTED=0,SharerDialogView.prototype.LABEL_SHARE_TEXT_ONLY=1,SharerDialogView.prototype.LABEL_IMAGE_UPLOADING=2,SharerDialogView.prototype.LABEL_WAITING=3,SharerDialogView.prototype.LABEL_IMAGE_UPLOADED=4,SharerDialogView.prototype.LABEL_CLICK_TO_SHARE=5,SharerDialogView.prototype.LABEL_IMAGE_UPLOAD_FAILED=6,SharerDialogView.prototype.LABEL_FACEBOOK_LOADING=7,SharerDialogView.prototype.LABEL_LOAD_FBSDK=8,SharerDialogView.prototype.LABEL_FBSDK_LOADING=9,SharerDialogView.prototype.beforeShow=function(){window.FB&&!this.facebookSDKReadyState&&(this.facebookSDKReadyState="complete",FB.getLoginStatus(this.updateFacebookStatus.bind(this)),FB.Event.subscribe("auth.authResponseChange",this.updateFacebookStatus.bind(this))),this.uploadSupported=!!(window.HTMLCanvasElement.prototype.toBlob&&window.XMLHttpRequest&&window.FormData),this.uploadSupported&&!this.imgurData?this.uploadImage():this.updateUI()},SharerDialogView.prototype.updateTermsUI=function(){this.termsElement.textContent=this.getCloudList()},SharerDialogView.prototype.getCloudTitle=function(){return this.app.data.title||_("my-word-cloud")},SharerDialogView.prototype.getCloudList=function(){for(var e=this.app.data.list,t=0,i=[];i[t]=e[t][0],++t<this.SHARED_ITEM_LIMIT;);return i.join(_("sep").replace(/"/g,""))+(e.length>this.SHARED_ITEM_LIMIT?_("frequent-terms-more"):"")},SharerDialogView.prototype.updateFacebookStatusElement=function(e,t){var i=this.facebookStatusElement;switch(this.facebookSDKReadyState){case"complete":this.updateStatusElement(i,e,t);break;case"loading":this.updateStatusElement(i,this.LABEL_FBSDK_LOADING);break;default:this.updateStatusElement(i,this.LABEL_LOAD_FBSDK,"#")}},SharerDialogView.prototype.updateStatusElement=function(e,t,i){i?(e.className="",e.href=i):(e.className="disabled",e.href=""),e.setAttribute("data-l10n-id",this.stringIds[t]),__(e)},SharerDialogView.prototype.updateUI=function(){if(this.xhr)this.reUploadBtnElement.disabled=!0,this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOADING),this.updateFacebookStatusElement(this.LABEL_WAITING),this.updateStatusElement(this.tumblrStatusElement,this.LABEL_WAITING),this.updateStatusElement(this.twitterStatusElement,this.LABEL_WAITING),this.updateStatusElement(this.plurkStatusElement,this.LABEL_WAITING);else if(this.imgurData){var e=this.IMGUR_URL+this.imgurData.id;this.reUploadBtnElement.disabled=!1,this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOADED,e),this.facebookPostedUrl?this.updateStatusElement(this.facebookStatusElement,this.LABEL_IMAGE_UPLOADED,this.facebookPostedUrl):this.facebookLoading?this.updateStatusElement(this.facebookStatusElement,this.LABEL_FACEBOOK_LOADING):this.updateFacebookStatusElement(this.LABEL_CLICK_TO_SHARE,"#"),this.updateStatusElement(this.tumblrStatusElement,this.LABEL_CLICK_TO_SHARE,"#"),this.updateStatusElement(this.twitterStatusElement,this.LABEL_CLICK_TO_SHARE,"#"),this.updateStatusElement(this.plurkStatusElement,this.LABEL_CLICK_TO_SHARE,"#")}else this.uploadSupported||this.updateTermsUI(),this.reUploadBtnElement.disabled=!0,this.uploadSupported?this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOAD_FAILED):this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOAD_NOT_SUPPORTED),this.updateFacebookStatusElement(this.LABEL_SHARE_TEXT_ONLY,"#"),this.updateStatusElement(this.tumblrStatusElement,this.LABEL_SHARE_TEXT_ONLY,"#"),this.updateStatusElement(this.twitterStatusElement,this.LABEL_SHARE_TEXT_ONLY,"#"),this.updateStatusElement(this.plurkStatusElement,this.LABEL_SHARE_TEXT_ONLY,"#")},SharerDialogView.prototype.afterHide=function(){this.xhr&&(this.xhr.abort(),this.xhr=null)},SharerDialogView.prototype.handleEvent=function(e){if(e.target.disabled||"disabled"===e.target.className)e.preventDefault();else switch(e.currentTarget){case this.imgLinkElement:if(this.imgurData)break;e.preventDefault();break;case this.facebookStatusElement:if(this.facebookPostedUrl)break;if(!this.facebookSDKReadyState)return this.facebookSDKReadyState="loading",this.updateUI(),(new FacebookSDKLoader).load(function(){"complete"!==this.facebookSDKReadyState&&(this.facebookSDKReadyState="complete",FB.getLoginStatus(this.updateFacebookStatus.bind(this)),FB.Event.subscribe("auth.authResponseChange",this.updateFacebookStatus.bind(this)))}.bind(this)),void e.preventDefault();this.share("facebook"),e.preventDefault();break;case this.tumblrStatusElement:this.share("tumblr"),e.preventDefault();break;case this.twitterStatusElement:this.share("twitter"),e.preventDefault();break;case this.plurkStatusElement:this.share("plurk"),e.preventDefault();break;case this.reUploadBtnElement:this.uploadImage();break;case this.doneBtnElement:this.close()}},SharerDialogView.prototype.close=function(){this.app.switchUIState(this.app.UI_STATE_DASHBOARD)},SharerDialogView.prototype.getCanvasBlob=function(e){this.app.getCanvasElement().toBlob(e.bind(this))},SharerDialogView.prototype.updateProgress=function(e,t){this.progressElement.style.width=Math.floor(100*e)+"%",this.progressElement.parentNode.className="progress progress-striped"+(t?" active":"")},SharerDialogView.prototype.share=function(e){("facebook"!==e||window.UPLOAD_PHOTO_TO_FACEBOOK)&&this.imgurData?this.shareImage(e):this.shareText(e)},SharerDialogView.prototype.shareText=function(e){this.app.logAction("SharerDialogView::shareText",e);var t=this.titleInputElement.value||this.getCloudTitle(),i=this.descInputElement.value||this.getCloudList()+"\n\n"+this.HASHTAG,o=window.location.href,a=128<o.length?o.replace(/#.*$/,""):o;switch(e){case"facebook":var n,r=document.querySelector('meta[property="og:image"]').content;this.facebookLoading=!0,this.updateUI(),n=this.imgurData?{method:"feed",link:this.IMGUR_URL+this.imgurData.id,display:"popup"}:{method:"feed",picture:r,link:o,name:this.getCloudTitle(),description:this.getCloudList()+" -- "+this.HASHTAG,display:"popup"},FB.ui(n,function(e){if(this.facebookLoading=!1,e&&e.post_id){var t=e.post_id.split("_");this.facebookPostedUrl=this.FACEBOOK_POST_URL.replace(/%uid/,t[0]).replace(/%fbid/,t[1]),this.updateUI()}else this.updateUI()}.bind(this));break;case"plurk":window.open(this.PLURK_SHARE_URL+encodeURIComponent(a+" ("+t+") "+i));break;case"twitter":window.open(this.TWITTER_SHARE_URL+encodeURIComponent(a+" "+t+" "+i),null,"width=575,height=216");break;case"tumblr":window.open("https://www.tumblr.com/share/link?description="+encodeURIComponent(i)+"&name="+encodeURIComponent(t)+"&url="+encodeURIComponent(o)),this.close();break;default:throw"Unknown shareDialogView type "+e}},SharerDialogView.prototype.updateFacebookStatus=function(e){"connected"===e.status?FB.api("/me/permissions",function(e){this.hasFacebookPermission=e&&e.data&&e.data[0]&&1==e.data[0].publish_stream,this.updateUI()}.bind(this)):this.hasFacebookPermission=!1,this.updateUI()},SharerDialogView.prototype.uploadImage=function(){if(!window.IMGUR_CLIENT_ID)throw"IMGUR_CLIENT_ID is not set.";this.app.logAction("SharerDialogView::uploadImage"),this.imgurData=void 0,this.facebookPostedUrl=void 0,this.imgLinkElement.href="#",this.updateProgress(.05,!0);var e=this.titleInputElement.value||this.getCloudTitle(),t=this.descInputElement.value||this.getCloudList()+"\n\n"+this.HASHTAG,i=window.location.href;128<i.length&&(i=i.replace(/#.*$/,"")),this.cloudUrl=i;var o=new FormData;o.append("title",e),o.append("name","wordcloud.png"),o.append("description",t+"\n\n"+i);var a=this.xhr=new XMLHttpRequest;a.open("POST",this.IMGUR_API_URL),a.setRequestHeader("Authorization","Client-ID "+IMGUR_CLIENT_ID),a.upload?a.upload.onprogress=function(e){this.updateProgress(e.loaded/e.total,!0)}.bind(this):this.updateProgress(1,!0),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE&&this.xhr===a){var e;this.checkImgurCredits(),this.xhr=null;try{e=JSON.parse(a.responseText)}catch(e){}if(!(!!e&&e.success))return e&&429===e.status&&alert(_("imgur-limit-msg")),this.app.logAction("SharerDialogView::uploadImage::failed",e?e.status:"N/A"),this.updateProgress(.05,!1),void this.updateUI();this.imgurData=e.data,this.imgLinkElement.href=this.IMGUR_URL+this.imgurData.id,this.app.logAction("SharerDialogView::uploadImage::success"),this.updateProgress(1,!1),this.updateUI()}}.bind(this),this.updateUI(),this.updateTermsUI(),this.getCanvasBlob(function(e){this.xhr===a&&(window.URL?this.imgElement.src=window.URL.createObjectURL(e):this.imgElement.src=this.app.getCanvasElement().toDataURL(),this.imgLinkElement.removeAttribute("hidden"),o.append("image",e),a.send(o))})},SharerDialogView.prototype.shareImage=function(t){this.app.logAction("SharerDialogView::shareImage2",t);var e=this.titleInputElement.value||this.getCloudTitle(),i=this.descInputElement.value||this.getCloudList()+"\n\n"+this.HASHTAG,o=this.cloudUrl;switch(t){case"facebook":if(!this.hasFacebookPermission)return void FB.login(function(e){this.element.hasAttribute("hidden")?this.app.logAction("SharerDialogView::facebook-login::cancelled"):(this.app.logAction("SharerDialogView::facebook-login::success"),"connected"===e.status&&(this.hasFacebookPermission=!0,this.shareImage(t)))}.bind(this),{scope:"publish_stream"});this.facebookLoading=!0,this.updateUI(),FB.api("/me/photos","post",{url:this.imgurData.link,message:this.titleInputElement.value+"\n\n"+this.descInputElement.value+"\n\n"+o},function(e){if(this.facebookLoading=!1,!e||!e.id)return this.shareText(t),void this.updateUI();this.facebookPostedUrl=this.FACEBOOK_PHOTO_URL+e.id,this.updateUI()}.bind(this));break;case"plurk":window.open(this.PLURK_SHARE_URL+encodeURIComponent(this.imgurData.link+" "+o+" ("+e+") "+i));break;case"twitter":window.open(this.TWITTER_SHARE_URL+encodeURIComponent(o+" "+e+" "+i+" "+this.imgurData.link));break;case"tumblr":window.open("https://www.tumblr.com/share/photo?source="+encodeURIComponent(this.imgurData.link)+"&desc="+encodeURIComponent(e+"\n"+i+"\n\n"+o)+"&clickthru="+encodeURIComponent(o));break;default:throw"Unknown shareDialogView type "+t}},SharerDialogView.prototype.checkImgurCredits=function(){var t=new XMLHttpRequest;t.open("GET","https://api.imgur.com/3/credits"),t.setRequestHeader("Authorization","Client-ID "+IMGUR_CLIENT_ID),t.onreadystatechange=function(){if(t.readyState===XMLHttpRequest.DONE){var e;try{e=JSON.parse(t.responseText)}catch(e){}e&&e.success&&(this.imgurCreditsData=e.data,this.app.logAction("SharerDialogView::checkImgurCredits::ClientRemaining",e.data.ClientRemaining))}}.bind(this),t.send()};var PanelView=function(){};PanelView.prototype=new View,PanelView.prototype.beforeShow=function(){this.menuItemElement.parentNode.className+=" active",this.dialog.selectionElement.selectedIndex=this.selectionIndex},PanelView.prototype.afterShow=function(){var e=this.element.querySelector("input, button, select, textarea");e&&e.focus()},PanelView.prototype.beforeHide=function(){this.menuItemElement.parentNode.className=this.menuItemElement.parentNode.className.replace(/ active/g,"")};var ExamplePanelView=function(e){this.load(e,{name:"example",element:"wc-panel-example",supportMsgElement:"wc-panel-example-support-msg"}),this.checked=!1};ExamplePanelView.prototype=new PanelView,ExamplePanelView.prototype.beforeShow=function(){PanelView.prototype.beforeShow.apply(this,arguments),this.checked||(this.dialog.app.isFullySupported||this.supportMsgElement.removeAttribute("hidden"),this.element.querySelectorAll('[name="example"]')[0].checked=!0,this.checked=!0)},ExamplePanelView.prototype.submit=function(){var e=this.element.querySelectorAll('[name="example"]');for(var t in e)if(e[t].checked){this.dialog.submit("#"+e[t].value);break}};var CPPanelView=function(e){this.load(e,{name:"cp",element:"wc-panel-cp",textareaElement:"wc-panel-cp-textarea"})};CPPanelView.prototype=new PanelView,CPPanelView.prototype.submit=function(){var e=this.textareaElement;e.value.length&&((window.btoa?this.dialog.submit("#base64:"+window.btoa(unescape(encodeURIComponent(e.value)))):this.dialog.submit("#text:"+encodeURIComponent(e.value)))||this.dialog.submit("#text"))};var FilePanelView=function(e){if(this.load(e,{name:"file",element:"wc-panel-file",fileElement:"wc-panel-file-file",fileLabelElement:"wc-panel-file-file-label",encodingElement:"wc-panel-file-encoding"}),this.isSupported){var t=this.fileElement.files.length;this.updateLabel(t),this.fileElement.addEventListener("change",this)}};FilePanelView.prototype=new PanelView,FilePanelView.prototype.handleEvent=function(){var e=this.fileElement.files.length;this.updateLabel(e)},FilePanelView.prototype.updateLabel=function(e){this.fileLabelElement.setAttribute("data-l10n-args",'{ "n": '+e+"}"),__(this.fileLabelElement)},FilePanelView.prototype.isSupported=!!window.FileReader,FilePanelView.prototype.submit=function(){var e=this.fileElement;e.files.length&&("text/plain"===e.files[0].type?this.dialog.submit("#file"):alert(_("plain-text-file-please")))};var WikipediaPanelView=function(e){this.load(e,{name:"wikipedia",element:"wc-panel-wikipedia",inputElement:"wc-panel-wikipedia-title"})};WikipediaPanelView.prototype=new PanelView,WikipediaPanelView.prototype.submit=function(){var e=this.inputElement;if(e.value){var t=document.webL10n.getLanguage().substr(0,2);this.dialog.submit("#wikipedia."+t+":"+e.value)}};var Fetcher=function(){};Fetcher.prototype.LABEL_VERB=LoadingView.prototype.LABEL_LOADING;var TextFetcher=function(){this.types=["text","base64"]};TextFetcher.prototype=new Fetcher,TextFetcher.prototype.stop=function(){clearTimeout(this.timer)},TextFetcher.prototype.getData=function(e,t){t="text"!==e||t?"base64"===e?decodeURIComponent(escape(window.atob(t))):decodeURIComponent(t):this.app.views["source-dialog"].panels.cp.textareaElement.value,this.timer=setTimeout(function(){this.app.handleData(t)}.bind(this),0)};var FileFetcher=function(){this.types=["file"]};FileFetcher.prototype=new Fetcher,FileFetcher.prototype.stop=function(){this.reader&&(this.reader.abort(),this.reader=null)},FileFetcher.prototype.getData=function(){var e=this.app.views["source-dialog"].panels.file,t=e.fileElement;if(!t.files.length)return this.app.reset(),void this.app.views["source-dialog"].showPanel(e);var i=t.files[0],o=this.reader=new FileReader;o.onloadend=function(){if(o===this.reader&&null!==o.result){var e=o.result;this.app.handleData(e)}}.bind(this),o.readAsText(i,e.encodingElement.value||"UTF-8")};var ListFetcher=function(){this.types=["list","base64-list"]};ListFetcher.prototype=new Fetcher,ListFetcher.prototype.stop=function(){clearTimeout(this.timer)},ListFetcher.prototype.getData=function(e,t){var i;i="list"!==e||t?"base64-list"===e?decodeURIComponent(escape(window.atob(t))):decodeURIComponent(t):this.app.views["list-dialog"].textElement.value;var o=0,a=[];i.split("\n").forEach(function(e){var t=e.split("\t").reverse();e&&t[0]&&t[1]&&(t[1]=parseInt(t[1],10),isNaN(t[1])||(o+=t[0].length*t[1]*t[1],a.push(t)))}),this.timer=setTimeout(function(){this.app.handleList(a,o)}.bind(this),0)};var JSONPScriptDownloader=function(){};JSONPScriptDownloader.prototype.CALLBACK_PREFIX="JSONPCallbackX",JSONPScriptDownloader.prototype.reset=JSONPScriptDownloader.prototype.stop=function(){this.currentRequest=void 0,clearTimeout(this.timer)},JSONPScriptDownloader.prototype.handleEvent=function(e){var t=e.target;window[t.getAttribute("data-callback-name")]=void 0,this.currentRequest=void 0,clearTimeout(this.timer),t.parentNode.removeChild(t),"error"===e.type&&this.fetcher.handleResponse()},JSONPScriptDownloader.prototype.getNewCallbackName=function(){var e=this.CALLBACK_PREFIX+Math.random().toString(36).substr(2,8).toUpperCase();return window[e]=function(){this.currentRequest===e&&(this.currentRequest=void 0,clearTimeout(this.timer),this.fetcher.handleResponse.apply(this.fetcher,arguments))}.bind(this),e},JSONPScriptDownloader.prototype.requestData=function(e){var t=this.currentRequest=this.getNewCallbackName();e+=-1===e.indexOf("?")?"?":"&",e+="callback="+t;var i=this.scriptElement=document.createElement("script");i.src=e,i.setAttribute("data-callback-name",t),i.addEventListener("load",this),i.addEventListener("error",this),document.documentElement.firstElementChild.appendChild(i),clearTimeout(this.timer),this.timer=setTimeout(function(){window[t]()},this.fetcher.TIMEOUT)};var JSONPWorkerDownloader=function(){};JSONPWorkerDownloader.prototype.PATH="./assets/",JSONPWorkerDownloader.prototype.reset=JSONPWorkerDownloader.prototype.stop=function(){this.worker&&(clearTimeout(this.timer),this.worker.terminate(),this.worker=null)},JSONPWorkerDownloader.prototype.requestData=function(e){this.worker&&this.stop(),this.worker=new Worker(this.PATH+"downloader-worker.js"),this.worker.addEventListener("message",this),this.worker.addEventListener("error",this),this.worker.postMessage(e),clearTimeout(this.timer),this.timer=setTimeout(function(){this.stop(),this.fetcher.handleResponse()}.bind(this),this.fetcher.TIMEOUT)},JSONPWorkerDownloader.prototype.handleEvent=function(e){var t;switch(e.type){case"message":t=e.data;break;case"error":t=[],e.preventDefault()}this.stop(),this.fetcher.handleResponse.apply(this.fetcher,t)};var JSONPFetcher=function(){};JSONPFetcher.prototype=new Fetcher,JSONPFetcher.prototype.LABEL_VERB=LoadingView.prototype.LABEL_DOWNLOADING,JSONPFetcher.prototype.USE_WORKER_WHEN_AVAILABLE=!0,JSONPFetcher.prototype.TIMEOUT=3e4,JSONPFetcher.prototype.reset=function(){this.downloader&&this.downloader.reset()},JSONPFetcher.prototype.stop=function(){this.downloader&&this.downloader.stop(),this.downloader=null},JSONPFetcher.prototype.requestData=function(e){this.USE_WORKER_WHEN_AVAILABLE&&window.Worker?this.downloader=new JSONPWorkerDownloader:this.downloader=new JSONPScriptDownloader,(this.downloader.fetcher=this).downloader.requestData(e)};var WikipediaFetcher=function(){this.types=["wiki","wikipedia"],this.params=[["action","query"],["prop","revisions"],["rvprop","content"],["redirects","1"],["format","json"],["rvparse","1"]]};WikipediaFetcher.prototype=new JSONPFetcher,WikipediaFetcher.prototype.WIKIPEDIA_API_URL="https://%lang.wikipedia.org/w/api.php",WikipediaFetcher.prototype.DEFAULT_LANG="en",WikipediaFetcher.prototype.PARSED_WIKITEXT_REGEXP=/<[^>]+?>|\(.+?\.\.\.\)|\&\w+\;|<script.+?\/script\>/gi,WikipediaFetcher.prototype.getData=function(e,t){var i=[].concat(this.params),o=e.split("."),a=o[1]?o[1]:this.DEFAULT_LANG;o[2]&&i.push(["converttitles",o[2]]),i.push(["titles",t]);var n=this.WIKIPEDIA_API_URL.replace(/%lang/,a)+"?"+i.map(function(e){return e[0]+"="+encodeURIComponent(e[1])}).join("&");this.requestData(n)},WikipediaFetcher.prototype.handleResponse=function(e){if(e){var t=Object.keys(e.query.pages)[0],i=e.query.pages[t];if("revisions"in i){var o=i.revisions[0]["*"].replace(this.PARSED_WIKITEXT_REGEXP,"");this.app.handleData(o,_("wikipedia-title",{title:i.title}))}else this.app.handleData("")}else this.app.handleData("")},"timdream.org"===window.location.hostname&&(window.location.href="https://wordcloud.timdream.org/"+window.location.hash);var _paq=window._paq||[];"1"!==navigator.doNotTrack?(_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="//stats.timdream.org/";_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","7"]);var t=document,i=t.createElement("script"),o=t.getElementsByTagName("script")[0];i.type="text/javascript",i.async=!0,i.defer=!0,i.src=e+"matomo.js",o.parentNode.insertBefore(i,o)}()):window.console&&(_paq.push=function(){Function.prototype.apply.call(console.log,console,arguments),Array.prototype.push.apply(this,arguments)}),window.onerror=function(e,t,i){_paq.push(["trackEvent","JavaScript Exceptions",e,t+" ("+i+")"])},function(){if(document.querySelectorAll&&window.console){var e=document.querySelector('meta[property="og:image"]').content,t=document.querySelector('meta[property="og:url"]').content,i=document.querySelector('meta[property="fb:app_id"]').content,o=window.location.href.replace(/#.*$/,"").replace(/\?.*$/,"");(e.substr(0,o.length)!==o||t.substr(0,o.length)!==o||window.FACEBOOK_APP_ID&&i!==window.FACEBOOK_APP_ID)&&console.warn("Remember to change the content of <meta> tags in HTML.")}}(),function(){void 0===window.__&&(window.__=document.webL10n.translate),WordFreq.isSupported?WordFreqSync=null:WordFreq=null;var e=new WordCloudApp;if(e.isSupported){(new LanguageSwitcherView).app=e,(new SNSPushView).show(),(new PSMView).show(),e.addView(new CanvasView),e.addView(new LoadingView),e.addView(new DashboardView),e.addView(new ListDialogView),e.addView(new SharerDialogView),e.addView(new AboutDialogView);var t=new SourceDialogView;e.addView(t),t.addPanel(new ExamplePanelView),t.addPanel(new CPPanelView),t.addPanel(new FilePanelView),t.addPanel(new WikipediaPanelView),e.addFetcher(new TextFetcher),e.addFetcher(new FileFetcher),e.addFetcher(new ListFetcher),e.addFetcher(new WikipediaFetcher)}}();